<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin ‚Äì Kanak Kumar Maity</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Raleway:wght@300;400;500&family=Cormorant+Garamond:ital,wght@0,400;1,400&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #c9a84c;
    --dark: #0d0b08;
    --cream: #f5f0e8;
    --bronze: #8b6914;
    --muted: #7a7060;
    --panel: #13110d;
    --red: #c0392b;
  }
  *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--dark); color:var(--cream); font-family:'Raleway',sans-serif; min-height:100vh; }

  /* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
  #loginPage {
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    background:radial-gradient(ellipse at center, #1a1408 0%, #0d0b08 70%);
  }
  .login-box {
    width:100%; max-width:420px; padding:3rem;
    border:1px solid rgba(201,168,76,.25); background:var(--panel); text-align:center;
  }
  .login-logo { font-family:'Cinzel',serif; font-size:1.8rem; color:var(--gold); margin-bottom:.3rem; }
  .login-sub { font-size:.7rem; letter-spacing:.3em; text-transform:uppercase; color:var(--muted); margin-bottom:2.5rem; }
  .login-box input {
    width:100%; background:rgba(255,255,255,.04); border:1px solid rgba(201,168,76,.2);
    color:var(--cream); padding:.85rem 1rem; font-family:'Raleway',sans-serif; font-size:.9rem;
    outline:none; margin-bottom:1rem; transition:border .2s;
  }
  .login-box input:focus { border-color:var(--gold); }
  .login-btn {
    width:100%; background:var(--gold); color:var(--dark); border:none; padding:.9rem;
    font-family:'Cinzel',serif; font-size:.9rem; letter-spacing:.15em; cursor:pointer; transition:background .2s;
  }
  .login-btn:hover { background:var(--bronze); color:var(--cream); }
  .login-error { color:var(--red); font-size:.8rem; margin-top:1rem; display:none; }
  .back-link { display:inline-block; margin-top:1.5rem; font-size:.7rem; letter-spacing:.2em; text-transform:uppercase; color:var(--muted); text-decoration:none; }
  .back-link:hover { color:var(--gold); }

  /* ‚îÄ‚îÄ ADMIN PANEL ‚îÄ‚îÄ */
  #adminPage { display:none; }
  .admin-header {
    background:rgba(13,11,8,.9); border-bottom:1px solid rgba(201,168,76,.2);
    padding:1rem 2rem; display:flex; align-items:center; justify-content:space-between;
    position:sticky; top:0; z-index:10;
  }
  .admin-title { font-family:'Cinzel',serif; color:var(--gold); font-size:1.1rem; letter-spacing:.1em; }
  .hdr-btn {
    font-size:.7rem; letter-spacing:.2em; text-transform:uppercase; background:transparent;
    border:1px solid rgba(201,168,76,.3); color:var(--muted); padding:.5rem 1.2rem; cursor:pointer;
    font-family:'Raleway',sans-serif; transition:.2s; text-decoration:none; display:inline-block;
  }
  .hdr-btn:hover { border-color:var(--gold); color:var(--gold); }

  .admin-body { max-width:900px; margin:0 auto; padding:3rem 2rem; }

  /* Cloudinary notice */
  .setup-box {
    background:rgba(201,168,76,.06); border:1px solid rgba(201,168,76,.2);
    border-left:3px solid var(--gold); padding:1.5rem 2rem; margin-bottom:2.5rem;
  }
  .setup-box h3 { font-family:'Cinzel',serif; color:var(--gold); font-size:.95rem; margin-bottom:.8rem; }
  .setup-box p { font-size:.85rem; color:var(--muted); line-height:1.8; }
  .setup-box ol { margin:.8rem 0 0 1.5rem; }
  .setup-box ol li { font-size:.85rem; color:var(--muted); line-height:1.8; }
  .setup-box code { background:rgba(0,0,0,.4); color:var(--gold); padding:.1rem .35rem; font-size:.8rem; }

  /* Config section */
  .config-section {
    background:var(--panel); border:1px solid rgba(201,168,76,.15); padding:2rem; margin-bottom:2rem;
  }
  .config-section h2 {
    font-family:'Cinzel',serif; font-size:1rem; color:var(--gold); margin-bottom:1.5rem;
    padding-bottom:.8rem; border-bottom:1px solid rgba(201,168,76,.1);
  }
  .field-row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; margin-bottom:1rem; }
  .field { display:flex; flex-direction:column; gap:.4rem; }
  .field label { font-size:.6rem; letter-spacing:.35em; text-transform:uppercase; color:var(--gold); }
  .field input {
    background:rgba(0,0,0,.3); border:1px solid rgba(201,168,76,.15); color:var(--cream);
    padding:.7rem 1rem; font-family:'Raleway',sans-serif; font-size:.9rem; outline:none; transition:border .2s;
  }
  .field input:focus { border-color:var(--gold); }
  .field .hint { font-size:.65rem; color:var(--muted); }
  .save-btn {
    background:transparent; border:1px solid var(--bronze); color:var(--bronze);
    padding:.6rem 1.8rem; font-size:.65rem; letter-spacing:.3em; text-transform:uppercase;
    cursor:pointer; font-family:'Raleway',sans-serif; transition:.2s; margin-top:.5rem;
  }
  .save-btn:hover { background:var(--bronze); color:var(--dark); }

  /* Upload section */
  .upload-section {
    background:var(--panel); border:1px solid rgba(201,168,76,.15); padding:2rem; margin-bottom:2rem;
  }
  .upload-section h2 {
    font-family:'Cinzel',serif; font-size:1rem; color:var(--gold); margin-bottom:1.5rem;
    padding-bottom:.8rem; border-bottom:1px solid rgba(201,168,76,.1);
  }
  .drop-zone {
    border:2px dashed rgba(201,168,76,.25); padding:2.5rem; text-align:center;
    cursor:pointer; transition:border .2s, background .2s; margin-bottom:1.2rem; position:relative;
  }
  .drop-zone:hover, .drop-zone.over { border-color:var(--gold); background:rgba(201,168,76,.04); }
  .drop-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
  .drop-icon { font-size:2rem; margin-bottom:.5rem; display:block; }
  .drop-text { font-size:.85rem; color:var(--muted); line-height:1.7; }

  .progress-wrap { display:none; margin-bottom:1rem; }
  .progress-bar { background:rgba(201,168,76,.1); height:3px; }
  .progress-fill { height:100%; background:var(--gold); width:0%; transition:width .3s; }
  .progress-label { font-size:.7rem; color:var(--gold); margin-top:.4rem; letter-spacing:.15em; }

  #previewImg { display:none; max-height:120px; margin-bottom:1rem; border:1px solid rgba(201,168,76,.2); }

  .meta-row { display:grid; grid-template-columns:1fr 100px; gap:1rem; margin-bottom:1rem; }
  .meta-row input {
    background:rgba(0,0,0,.3); border:1px solid rgba(201,168,76,.15); color:var(--cream);
    padding:.75rem 1rem; font-family:'Raleway',sans-serif; font-size:.9rem; outline:none; transition:border .2s;
  }
  .meta-row input:focus { border-color:var(--gold); }
  .meta-row input::placeholder { color:var(--muted); opacity:.6; }

  .add-btn {
    background:var(--gold); color:var(--dark); border:none; padding:.8rem 2rem;
    font-family:'Cinzel',serif; font-size:.9rem; cursor:pointer; transition:background .2s;
  }
  .add-btn:hover { background:var(--bronze); color:var(--cream); }
  .add-btn:disabled { opacity:.4; cursor:not-allowed; }

  /* Gallery manage */
  .manage-section h2 {
    font-family:'Cinzel',serif; font-size:1rem; color:var(--gold); margin-bottom:1.5rem;
    padding-bottom:.8rem; border-bottom:1px solid rgba(201,168,76,.1);
  }
  .manage-grid {
    display:grid; grid-template-columns:repeat(auto-fill, minmax(200px,1fr)); gap:1px;
    background:rgba(201,168,76,.08);
  }
  .manage-card { background:var(--panel); overflow:hidden; }
  .manage-card img { width:100%; height:150px; object-fit:cover; display:block; filter:sepia(.15); transition:filter .3s; }
  .manage-card:hover img { filter:sepia(0); }
  .card-bottom { padding:.75rem; display:flex; justify-content:space-between; align-items:center; gap:.5rem; }
  .card-title { font-size:.78rem; color:var(--cream); flex:1; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
  .card-year { font-size:.7rem; color:var(--gold); }
  .del-btn {
    background:transparent; border:1px solid rgba(192,57,43,.4); color:var(--red);
    padding:.3rem .6rem; font-size:.65rem; cursor:pointer; font-family:'Raleway',sans-serif; transition:.2s;
  }
  .del-btn:hover { background:var(--red); border-color:var(--red); color:#fff; }
  .empty-manage { text-align:center; color:var(--muted); font-style:italic; padding:2.5rem; grid-column:1/-1; }

  /* Toast */
  .toast {
    position:fixed; bottom:2rem; right:2rem; padding:.8rem 1.6rem; font-size:.78rem;
    opacity:0; transform:translateY(8px); transition:.3s; z-index:9999; pointer-events:none;
    font-family:'Cinzel',serif; letter-spacing:.08em;
  }
  .toast.ok  { background:var(--gold); color:var(--dark); }
  .toast.err { background:var(--red); color:#fff; }
  .toast.show { opacity:1; transform:translateY(0); }

  @media(max-width:600px){
    .field-row { grid-template-columns:1fr; }
    .meta-row  { grid-template-columns:1fr; }
  }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <div class="login-logo">KKM</div>
    <div class="login-sub">Admin Panel ¬∑ Sculptor Portfolio</div>
    <input type="email"    id="emailIn" placeholder="Email address" autocomplete="username">
    <input type="password" id="passIn"  placeholder="Password" autocomplete="current-password"
      onkeydown="if(event.key==='Enter')doLogin()">
    <button class="login-btn" onclick="doLogin()">Login</button>
    <div class="login-error" id="loginErr">Incorrect email or password.</div>
    <a href="index.html" class="back-link">‚Üê Back to Portfolio</a>
  </div>
</div>

<!-- ADMIN -->
<div id="adminPage">
  <div class="admin-header">
    <span class="admin-title">Admin Panel ‚Äî Kanak Kumar Maity</span>
    <div style="display:flex;gap:.8rem;align-items:center">
      <a href="index.html" target="_blank" class="hdr-btn">View Site ‚Üó</a>
      <button class="hdr-btn" style="border-color:rgba(192,57,43,.4);color:rgba(192,57,43,.7)" onclick="doLogout()">Logout</button>
    </div>
  </div>

  <div class="admin-body">

    <!-- Cloudinary setup guide -->
    <div class="setup-box" id="setupBox">
      <h3>üì∑ Cloudinary Setup ‚Äî Sirf Ek Baar</h3>
      <p>Photo upload ke liye free Cloudinary account chahiye. Neeche Cloud Name aur Upload Preset daalo:</p>
      <ol>
        <li><a href="https://cloudinary.com" target="_blank" style="color:var(--gold)">cloudinary.com</a> ‚Üí Free Sign Up karo</li>
        <li>Dashboard pe apna <strong>Cloud Name</strong> dikhega ‚Äî copy karo</li>
        <li>Settings ‚Üí Upload ‚Üí Upload Presets ‚Üí <strong>Add Upload Preset</strong></li>
        <li>Signing Mode = <code>Unsigned</code> rakho ‚Üí naam daao <code>kkm_portfolio</code> ‚Üí Save</li>
        <li>Neeche woh values daalo aur Save karo ‚úÖ</li>
      </ol>
    </div>

    <!-- Cloudinary config -->
    <div class="config-section">
      <h2>‚òÅÔ∏è Cloudinary Settings</h2>
      <div class="field-row">
        <div class="field">
          <label>Cloud Name</label>
          <input type="text" id="cloudName" placeholder="e.g. mycloud123">
          <span class="hint">Cloudinary Dashboard pe milega</span>
        </div>
        <div class="field">
          <label>Upload Preset</label>
          <input type="text" id="uploadPreset" placeholder="e.g. kkm_portfolio">
          <span class="hint">Settings ‚Üí Upload ‚Üí Upload Presets mein banao (Unsigned)</span>
        </div>
      </div>
      <button class="save-btn" onclick="saveCloudinaryConfig()">Save Cloudinary Settings</button>
    </div>

    <!-- Upload -->
    <div class="upload-section">
      <h2>üñºÔ∏è Nayi Artwork Add Karo</h2>

      <div class="drop-zone" id="dropZone">
        <input type="file" accept="image/*" id="fileInput" onchange="onFileSelect(this.files[0])">
        <span class="drop-icon">üì∏</span>
        <div class="drop-text">Click karke photo choose karo ya yahan drag karo<br>
          <small style="opacity:.6">(Photo Cloudinary pe upload hogi ‚Äî hamesha ke liye save)</small></div>
      </div>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
        <div class="progress-label" id="progressLabel">Uploading...</div>
      </div>

      <img id="previewImg" src="" alt="Preview">

      <div class="meta-row">
        <input type="text" id="titleInput" placeholder="Artwork title  (e.g. Seated Figure ‚Äî Dokra Bronze)">
        <input type="text" id="yearInput"  placeholder="Saal  (2022)">
      </div>

      <button class="add-btn" id="addBtn" onclick="addArtwork()" disabled>Gallery Mein Add Karo</button>
    </div>

    <!-- Manage -->
    <div class="manage-section">
      <h2>üìÇ Gallery Manage Karo</h2>
      <div class="manage-grid" id="manageGrid">
        <div class="empty-manage">Koi artwork nahi hai abhi.</div>
      </div>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
  // ‚îÄ‚îÄ Firebase (hardcoded ‚Äî no setup needed) ‚îÄ‚îÄ
  firebase.initializeApp({
    apiKey:            "AIzaSyCupq8wPWF_yY7vJ4fqWk1MJZNePHN996U",
    authDomain:        "kanak-maity.firebaseapp.com",
    projectId:         "kanak-maity",
    storageBucket:     "kanak-maity.firebasestorage.app",
    messagingSenderId: "591071053602",
    appId:             "1:591071053602:web:9b1cce3a49674cd12cc77b"
  });
  const db = firebase.firestore();

  // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ
  const ADMIN_EMAIL = 'kanakmaity111@gmail.com';
  const ADMIN_PASS  = 'KKMaity@2024';

  function isLoggedIn() { return sessionStorage.getItem('kkm_auth') === '1'; }

  function doLogin() {
    const e = document.getElementById('emailIn').value.trim();
    const p = document.getElementById('passIn').value;
    if (e === ADMIN_EMAIL && p === ADMIN_PASS) {
      sessionStorage.setItem('kkm_auth','1');
      showAdmin();
    } else {
      document.getElementById('loginErr').style.display = 'block';
    }
  }

  function doLogout() {
    sessionStorage.removeItem('kkm_auth');
    location.reload();
  }

  function showAdmin() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('adminPage').style.display = 'block';
    loadCloudinaryConfig();
    loadManage();
  }

  // ‚îÄ‚îÄ Cloudinary config (localStorage mein save) ‚îÄ‚îÄ
  function loadCloudinaryConfig() {
    const cn = localStorage.getItem('kkm_cloud_name') || '';
    const up = localStorage.getItem('kkm_upload_preset') || '';
    document.getElementById('cloudName').value    = cn;
    document.getElementById('uploadPreset').value = up;
    if (cn && up) document.getElementById('setupBox').style.display = 'none';
  }

  function saveCloudinaryConfig() {
    const cn = document.getElementById('cloudName').value.trim();
    const up = document.getElementById('uploadPreset').value.trim();
    if (!cn || !up) { showToast('Dono fields bharo!','err'); return; }
    localStorage.setItem('kkm_cloud_name',    cn);
    localStorage.setItem('kkm_upload_preset', up);
    document.getElementById('setupBox').style.display = 'none';
    showToast('Cloudinary settings save ho gaya ‚úì','ok');
  }

  // ‚îÄ‚îÄ File upload to Cloudinary ‚îÄ‚îÄ
  let pendingUrl = null;

  function onFileSelect(file) {
    if (!file) return;
    const cn = localStorage.getItem('kkm_cloud_name');
    const up = localStorage.getItem('kkm_upload_preset');
    if (!cn || !up) { showToast('Pehle Cloudinary settings save karo!','err'); return; }

    const wrap  = document.getElementById('progressWrap');
    const fill  = document.getElementById('progressFill');
    const label = document.getElementById('progressLabel');
    wrap.style.display = 'block';
    fill.style.width   = '0%';
    label.textContent  = 'Uploading...';

    const fd = new FormData();
    fd.append('file', file);
    fd.append('upload_preset', up);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', `https://api.cloudinary.com/v1_1/${cn}/image/upload`);

    xhr.upload.onprogress = e => {
      if (e.lengthComputable) {
        const p = Math.round(e.loaded/e.total*100);
        fill.style.width  = p + '%';
        label.textContent = `Uploading... ${p}%`;
      }
    };

    xhr.onload = () => {
      if (xhr.status === 200) {
        const res = JSON.parse(xhr.responseText);
        pendingUrl = res.secure_url;
        fill.style.width  = '100%';
        label.textContent = 'Upload complete ‚úì';
        document.getElementById('previewImg').src          = pendingUrl;
        document.getElementById('previewImg').style.display = 'block';
        document.getElementById('addBtn').disabled          = false;
        showToast('Photo upload ho gaya! Ab title daalo aur save karo.','ok');
        setTimeout(() => wrap.style.display = 'none', 2000);
      } else {
        showToast('Upload fail hua ‚Äî Cloud Name aur Preset check karo','err');
        wrap.style.display = 'none';
      }
    };
    xhr.onerror = () => { showToast('Upload error','err'); wrap.style.display='none'; };
    xhr.send(fd);
  }

  // Drag & drop
  const dz = document.getElementById('dropZone');
  dz.addEventListener('dragover',  e => { e.preventDefault(); dz.classList.add('over'); });
  dz.addEventListener('dragleave', ()  => dz.classList.remove('over'));
  dz.addEventListener('drop', e => {
    e.preventDefault(); dz.classList.remove('over');
    const f = e.dataTransfer.files[0];
    if (f) onFileSelect(f);
  });

  // ‚îÄ‚îÄ Add artwork to Firestore ‚îÄ‚îÄ
  async function addArtwork() {
    if (!pendingUrl) return;
    const title = document.getElementById('titleInput').value.trim() || 'Untitled';
    const year  = document.getElementById('yearInput').value.trim();

    document.getElementById('addBtn').disabled    = true;
    document.getElementById('addBtn').textContent = 'Saving...';

    try {
      await db.collection('artworks').add({
        url:       pendingUrl,
        title,
        year,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });

      // Reset
      pendingUrl = null;
      document.getElementById('titleInput').value         = '';
      document.getElementById('yearInput').value          = '';
      document.getElementById('fileInput').value          = '';
      document.getElementById('previewImg').style.display = 'none';
      document.getElementById('addBtn').disabled          = false;
      document.getElementById('addBtn').textContent       = 'Gallery Mein Add Karo';

      showToast('Artwork add ho gaya! Website pe ab dikh raha hai ‚úì','ok');
      loadManage();
    } catch(err) {
      showToast('Error: ' + err.message,'err');
      document.getElementById('addBtn').disabled    = false;
      document.getElementById('addBtn').textContent = 'Gallery Mein Add Karo';
    }
  }

  // ‚îÄ‚îÄ Delete artwork ‚îÄ‚îÄ
  async function deleteWork(docId) {
    if (!confirm('Is artwork ko gallery se hatana chahte ho?')) return;
    try {
      await db.collection('artworks').doc(docId).delete();
      showToast('Hata diya.','ok');
      loadManage();
    } catch(err) {
      showToast('Error: ' + err.message,'err');
    }
  }

  // ‚îÄ‚îÄ Load manage grid ‚îÄ‚îÄ
  async function loadManage() {
    const grid = document.getElementById('manageGrid');
    grid.innerHTML = '<div class="empty-manage" style="opacity:.5">Loading...</div>';
    try {
      const snap = await db.collection('artworks').orderBy('createdAt','desc').get();
      if (snap.empty) {
        grid.innerHTML = '<div class="empty-manage">Abhi koi artwork nahi hai ‚Äî upar se upload karo.</div>';
        return;
      }
      grid.innerHTML = '';
      snap.forEach(doc => {
        const w = doc.data();
        const card = document.createElement('div');
        card.className = 'manage-card';
        card.innerHTML = `
          <img src="${esc(w.url)}" alt="${esc(w.title)}" loading="lazy">
          <div class="card-bottom">
            <span class="card-title" title="${esc(w.title)}">${esc(w.title)}</span>
            ${w.year ? `<span class="card-year">${esc(w.year)}</span>` : ''}
            <button class="del-btn" onclick="deleteWork('${doc.id}')">Hatao</button>
          </div>`;
        grid.appendChild(card);
      });
    } catch(err) {
      grid.innerHTML = `<div class="empty-manage" style="color:#c0392b">Firebase error ‚Äî please try again.<br><small>${err.message}</small></div>`;
    }
  }

  function esc(s) {
    return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
  let toastTimer;
  function showToast(msg, type='ok') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = `toast ${type} show`;
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
  }

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  if (isLoggedIn()) showAdmin();
</script>
</body>
</html>
